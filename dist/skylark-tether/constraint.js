/**
 * skylark-tether - A version of tether that ported to running on skylarkjs ui.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-tether/
 * @license MIT
 */
define(["./utils/classes","./utils/deferred","./utils/general","./utils/bounds","./utils/type-check"],function(t,e,o,s,i){"use strict";const n=["left","top","right","bottom"];function f(t,e,o){if(!o)return null;if("scrollParent"===o?o=e.scrollParents[0]:"window"===o&&(o=[pageXOffset,pageYOffset,innerWidth+pageXOffset,innerHeight+pageYOffset]),o===document&&(o=o.documentElement),!i.isUndefined(o.nodeType)){const e=o,i=s.getBounds(t,o),f=i,l=getComputedStyle(o);if(o=[f.left,f.top,i.width+f.left,i.height+f.top],e.ownerDocument!==document){let t=e.ownerDocument.defaultView;o[0]+=t.pageXOffset,o[1]+=t.pageYOffset,o[2]+=t.pageXOffset,o[3]+=t.pageYOffset}n.forEach((t,e)=>{"Top"===(t=t[0].toUpperCase()+t.substr(1))||"Left"===t?o[e]+=parseFloat(l[`border${t}Width`]):o[e]-=parseFloat(l[`border${t}Width`])})}return o}return{position({top:n,left:l,targetAttachment:p}){if(!this.options.constraints)return!0;let{height:h,width:r}=this.cache("element-bounds",()=>s.getBounds(this.bodyElement,this.element));0!==r||0!==h||i.isUndefined(this.lastSize)||({width:r,height:h}=this.lastSize);const a=this.cache("target-bounds",()=>this.getTargetBounds()),{height:d,width:u}=a,{classes:g,classPrefix:c}=this.options,m=function(e,o,s){const i=[t.getClass("pinned",e,o),t.getClass("out-of-bounds",e,o)];return s.forEach(t=>{const{outOfBoundsClass:e,pinnedClass:o}=t;e&&i.push(e),o&&i.push(o)}),i.forEach(t=>{["left","top","right","bottom"].forEach(e=>{i.push(`${t}-${e}`)})}),i}(g,c,this.options.constraints),b=[],O=o.extend({},p),C=o.extend({},this.attachment);return this.options.constraints.forEach(e=>{let o,s,{to:a,attachment:m,pin:x}=e;i.isUndefined(m)&&(m=""),m.indexOf(" ")>=0?[s,o]=m.split(" "):o=s=m;const E=f(this.bodyElement,this,a);"target"!==s&&"both"!==s||(n<E[1]&&"top"===O.top&&(n+=d,O.top="bottom"),n+h>E[3]&&"bottom"===O.top&&(n-=d,O.top="top")),"together"===s&&(n=function(t,e,o,s,i,n){return"top"===t.top&&("bottom"===e.top&&n<o[1]?(n+=i,t.top="bottom",n+=s,e.top="top"):"top"===e.top&&n+s>o[3]&&n-(s-i)>=o[1]&&(n-=s-i,t.top="bottom",e.top="bottom")),"bottom"===t.top&&("top"===e.top&&n+s>o[3]?(n-=i,t.top="top",n-=s,e.top="bottom"):"bottom"===e.top&&n<o[1]&&n+(2*s-i)<=o[3]&&(n+=s-i,t.top="top",e.top="top")),"middle"===t.top&&(n+s>o[3]&&"top"===e.top?(n-=s,e.top="bottom"):n<o[1]&&"bottom"===e.top&&(n+=s,e.top="top")),n}(O,C,E,h,d,n)),"target"!==o&&"both"!==o||(l<E[0]&&"left"===O.left&&(l+=u,O.left="right"),l+r>E[2]&&"right"===O.left&&(l-=u,O.left="left")),"together"===o&&(l=function(t,e,o,s,i,n){return n<o[0]&&"left"===t.left?"right"===e.left?(n+=i,t.left="right",n+=s,e.left="left"):"left"===e.left&&(n+=i,t.left="right",n-=s,e.left="right"):n+s>o[2]&&"right"===t.left?"left"===e.left?(n-=i,t.left="left",n-=s,e.left="right"):"right"===e.left&&(n-=i,t.left="left",n+=s,e.left="left"):"center"===t.left&&(n+s>o[2]&&"left"===e.left?(n-=s,e.left="right"):n<o[0]&&"right"===e.left&&(n+=s,e.left="left")),n}(O,C,E,r,u,l)),"element"!==s&&"both"!==s||(n<E[1]&&"bottom"===C.top&&(n+=h,C.top="top"),n+h>E[3]&&"top"===C.top&&(n-=h,C.top="bottom")),"element"!==o&&"both"!==o||(l<E[0]&&("right"===C.left?(l+=r,C.left="left"):"center"===C.left&&(l+=r/2,C.left="left")),l+r>E[2]&&("left"===C.left?(l-=r,C.left="right"):"center"===C.left&&(l-=r/2,C.left="right"))),i.isString(x)?x=x.split(",").map(t=>t.trim()):!0===x&&(x=["top","left","right","bottom"]);const w=[],$=[];if(l=function(t,e,o,s,i,n){return t<e[0]&&(s.indexOf("left")>=0?(t=e[0],i.push("left")):n.push("left")),t+o>e[2]&&(s.indexOf("right")>=0?(t=e[2]-o,i.push("right")):n.push("right")),t}(l,E,r,x=x||[],w,$),n=function(t,e,o,s,i,n){return t<e[1]&&(s.indexOf("top")>=0?(t=e[1],i.push("top")):n.push("top")),t+o>e[3]&&(s.indexOf("bottom")>=0?(t=e[3]-o,i.push("bottom")):n.push("bottom")),t}(n,E,h,x,w,$),w.length){let e;e=i.isUndefined(this.options.pinnedClass)?t.getClass("pinned",g,c):this.options.pinnedClass,b.push(e),w.forEach(t=>{b.push(`${e}-${t}`)})}!function(e,o,s,n,f){if(e.length){let l;l=i.isUndefined(f)?t.getClass("out-of-bounds",s,n):f,o.push(l),e.forEach(t=>{o.push(`${l}-${t}`)})}}($,b,g,c,this.options.outOfBoundsClass),(w.indexOf("left")>=0||w.indexOf("right")>=0)&&(C.left=O.left=!1),(w.indexOf("top")>=0||w.indexOf("bottom")>=0)&&(C.top=O.top=!1),O.top===p.top&&O.left===p.left&&C.top===this.attachment.top&&C.left===this.attachment.left||(this.updateAttachClasses(C,O),this.trigger("update",{attachment:C,targetAttachment:O}))}),e.defer(()=>{!1!==this.options.addTargetClasses&&t.updateClasses(this.target,b,m),t.updateClasses(this.element,b,m)}),{top:n,left:l}}}});
//# sourceMappingURL=sourcemaps/constraint.js.map
