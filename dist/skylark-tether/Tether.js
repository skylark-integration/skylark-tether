/**
 * skylark-tether - A version of tether that ported to running on skylarkjs ui.
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-integration/skylark-tether/
 * @license MIT
 */
define(["skylark-langx/skylark","./abutment","./constraint","./shift","./evented","./utils/classes","./utils/deferred","./utils/general","./utils/offset","./utils/bounds","./utils/parents","./utils/type-check"],function(t,e,s,i,o,a,n,l,h,r,d,f){"use strict";const c={modules:[s,e,i]};function p(t){let e=t.ownerDocument;return(e.fullscreenElement||e.webkitFullscreenElement||e.mozFullScreenElement||e.msFullscreenElement)===t}function m(t,e,s=1){return t+s>=e&&e>=t-s}const g=(()=>{if(f.isUndefined(document))return"";const t=document.createElement("div"),e=["transform","WebkitTransform","OTransform","MozTransform","msTransform"];for(let s=0;s<e.length;++s){const i=e[s];if(void 0!==t.style[i])return i}})(),u=[],b=()=>{u.forEach(t=>{t.position(!1)}),n.flush()};function C(){return performance.now()}(()=>{let t=null,e=null,s=null;const i=()=>{if(!f.isUndefined(e)&&e>16)return e=Math.min(e-16,250),void(s=setTimeout(i,250));!f.isUndefined(t)&&C()-t<10||(null!=s&&(clearTimeout(s),s=null),t=C(),b(),e=C()-t)};f.isUndefined(window)||f.isUndefined(window.addEventListener)||["resize","scroll","touchmove"].forEach(t=>{window.addEventListener(t,i)})})();class v extends o.Evented{constructor(t){super(),this.position=this.position.bind(this),u.push(this),this.history=[],this.setOptions(t,!1),c.modules.forEach(module=>{f.isUndefined(module.initialize)||module.initialize.call(this)}),this.position()}setOptions(t,e=!0){const s={offset:"0 0",targetOffset:"0 0",targetAttachment:"auto auto",classPrefix:"tether",bodyElement:document.body};this.options=l.extend(s,t);let{element:i,target:o,targetModifier:a,bodyElement:n}=this.options;if(this.element=i,this.target=o,this.targetModifier=a,"string"==typeof n&&(n=document.querySelector(n)),this.bodyElement=n,"viewport"===this.target?(this.target=document.body,this.targetModifier="visible"):"scroll-handle"===this.target&&(this.target=document.body,this.targetModifier="scroll-handle"),["element","target"].forEach(t=>{if(f.isUndefined(this[t]))throw new Error("Tether Error: Both element and target must be defined");f.isUndefined(this[t].jquery)?f.isString(this[t])&&(this[t]=document.querySelector(this[t])):this[t]=this[t][0]}),this._addClasses(),!this.options.attachment)throw new Error("Tether Error: You must provide an attachment");this.targetAttachment=h.parseTopLeft(this.options.targetAttachment),this.attachment=h.parseTopLeft(this.options.attachment),this.offset=h.parseTopLeft(this.options.offset),this.targetOffset=h.parseTopLeft(this.options.targetOffset),f.isUndefined(this.scrollParents)||this.disable(),"scroll-handle"===this.targetModifier?this.scrollParents=[this.target]:this.scrollParents=d.getScrollParents(this.target),!1!==this.options.enabled&&this.enable(e)}getTargetBounds(){return f.isUndefined(this.targetModifier)?r.getBounds(this.bodyElement,this.target):"visible"===this.targetModifier?r.getVisibleBounds(this.bodyElement,this.target):"scroll-handle"===this.targetModifier?r.getScrollHandleBounds(this.bodyElement,this.target):void 0}clearCache(){this._cache={}}cache(t,e){return f.isUndefined(this._cache)&&(this._cache={}),f.isUndefined(this._cache[t])&&(this._cache[t]=e.call(this)),this._cache[t]}enable(t=!0){const{classes:e,classPrefix:s}=this.options;!1!==this.options.addTargetClasses&&a.addClass(this.target,a.getClass("enabled",e,s)),a.addClass(this.element,a.getClass("enabled",e,s)),this.enabled=!0,this.scrollParents.forEach(t=>{t!==this.target.ownerDocument&&t.addEventListener("scroll",this.position)}),t&&this.position()}disable(){const{classes:t,classPrefix:e}=this.options;a.removeClass(this.target,a.getClass("enabled",t,e)),a.removeClass(this.element,a.getClass("enabled",t,e)),this.enabled=!1,f.isUndefined(this.scrollParents)||this.scrollParents.forEach(t=>{t.removeEventListener("scroll",this.position)})}destroy(){this.disable(),this._removeClasses(),u.forEach((t,e)=>{t===this&&u.splice(e,1)}),0===u.length&&r.removeUtilElements(this.bodyElement)}updateAttachClasses(t,e){t=t||this.attachment,e=e||this.targetAttachment;const{classes:s,classPrefix:i}=this.options;!f.isUndefined(this._addAttachClasses)&&this._addAttachClasses.length&&this._addAttachClasses.splice(0,this._addAttachClasses.length),f.isUndefined(this._addAttachClasses)&&(this._addAttachClasses=[]),this.add=this._addAttachClasses,t.top&&this.add.push(`${a.getClass("element-attached",s,i)}-${t.top}`),t.left&&this.add.push(`${a.getClass("element-attached",s,i)}-${t.left}`),e.top&&this.add.push(`${a.getClass("target-attached",s,i)}-${e.top}`),e.left&&this.add.push(`${a.getClass("target-attached",s,i)}-${e.left}`),this.all=[],["left","top","bottom","right","middle","center"].forEach(t=>{this.all.push(`${a.getClass("element-attached",s,i)}-${t}`),this.all.push(`${a.getClass("target-attached",s,i)}-${t}`)}),n.defer(()=>{f.isUndefined(this._addAttachClasses)||(a.updateClasses(this.element,this._addAttachClasses,this.all),!1!==this.options.addTargetClasses&&a.updateClasses(this.target,this._addAttachClasses,this.all),delete this._addAttachClasses)})}position(t=!0){if(!this.enabled)return;this.clearCache();const e=h.autoToFixedAttachment(this.targetAttachment,this.attachment);this.updateAttachClasses(this.attachment,e);const s=this.cache("element-bounds",()=>r.getBounds(this.bodyElement,this.element));let{width:i,height:o}=s;0!==i||0!==o||f.isUndefined(this.lastSize)?this.lastSize={width:i,height:o}:({width:i,height:o}=this.lastSize);const a=this.cache("target-bounds",()=>this.getTargetBounds()),p=a;let m=h.offsetToPx(h.attachmentToOffset(this.attachment),{width:i,height:o}),g=h.offsetToPx(h.attachmentToOffset(e),p);const u=h.offsetToPx(this.offset,{width:i,height:o}),b=h.offsetToPx(this.targetOffset,p);m=h.addOffset(m,u),g=h.addOffset(g,b);let C,v=a.left+g.left-m.left,y=a.top+g.top-m.top;for(let t=0;t<c.modules.length;++t){const i=c.modules[t].position.call(this,{left:v,top:y,targetAttachment:e,targetPos:a,elementPos:s,offset:m,targetOffset:g,manualOffset:u,manualTargetOffset:b,scrollbarSize:C,attachment:this.attachment});if(!1===i)return!1;!f.isUndefined(i)&&f.isObject(i)&&({top:y,left:v}=i)}const E={page:{top:y,left:v},viewport:{top:y-pageYOffset,bottom:pageYOffset-y-o+innerHeight,left:v-pageXOffset,right:pageXOffset-v-i+innerWidth}};let w=this.target.ownerDocument,x=w.defaultView;if(x.innerHeight>w.documentElement.clientHeight&&(C=this.cache("scrollbar-size",l.getScrollBarSize),E.viewport.bottom-=C.height),x.innerWidth>w.documentElement.clientWidth&&(C=this.cache("scrollbar-size",l.getScrollBarSize),E.viewport.right-=C.width),-1!==["","static"].indexOf(w.body.style.position)&&-1!==["","static"].indexOf(w.body.parentElement.style.position)||(E.page.bottom=w.body.scrollHeight-y-o,E.page.right=w.body.scrollWidth-v-i),!f.isUndefined(this.options.optimizations)&&!1!==this.options.optimizations.moveElement&&f.isUndefined(this.targetModifier)){const t=this.cache("target-offsetparent",()=>d.getOffsetParent(this.target)),e=this.cache("target-offsetparent-bounds",()=>r.getBounds(this.bodyElement,t)),s=getComputedStyle(t),i=e,o={};if(["Top","Left","Bottom","Right"].forEach(t=>{o[t.toLowerCase()]=parseFloat(s[`border${t}Width`])}),e.right=w.body.scrollWidth-e.left-i.width+o.right,e.bottom=w.body.scrollHeight-e.top-i.height+o.bottom,E.page.top>=e.top+o.top&&E.page.bottom>=e.bottom&&E.page.left>=e.left+o.left&&E.page.right>=e.right){const{scrollLeft:s,scrollTop:i}=t;E.offset={top:E.page.top-e.top+i-o.top,left:E.page.left-e.left+s-o.left}}}return this.move(E),this.history.unshift(E),this.history.length>3&&this.history.pop(),t&&n.flush(),!0}move(t){if(f.isUndefined(this.element.parentNode))return;const e={};for(let s in t){e[s]={};for(let i in t[s]){let o=!1;for(let e=0;e<this.history.length;++e){const a=this.history[e];if(!f.isUndefined(a[s])&&!m(a[s][i],t[s][i])){o=!0;break}}o||(e[s][i]=!0)}}let s={top:"",left:"",right:"",bottom:""};const i=(t,e)=>{if(!1!==(!f.isUndefined(this.options.optimizations)?this.options.optimizations.gpu:null)){let i,o;t.top?(s.top=0,i=e.top):(s.bottom=0,i=-e.bottom),t.left?(s.left=0,o=e.left):(s.right=0,o=-e.right),f.isNumber(window.devicePixelRatio)&&devicePixelRatio%1==0&&(o=Math.round(o*devicePixelRatio)/devicePixelRatio,i=Math.round(i*devicePixelRatio)/devicePixelRatio),s[g]=`translateX(${o}px) translateY(${i}px)`,"msTransform"!==g&&(s[g]+=" translateZ(0)")}else t.top?s.top=`${e.top}px`:s.bottom=`${e.bottom}px`,t.left?s.left=`${e.left}px`:s.right=`${e.right}px`};let o=!0;!f.isUndefined(this.options.optimizations)&&!1===this.options.optimizations.allowPositionFixed&&(o=!1);let a=!1;if((e.page.top||e.page.bottom)&&(e.page.left||e.page.right))s.position="absolute",i(e.page,t.page);else if(o&&(e.viewport.top||e.viewport.bottom)&&(e.viewport.left||e.viewport.right))s.position="fixed",i(e.viewport,t.viewport);else if(!f.isUndefined(e.offset)&&e.offset.top&&e.offset.left){s.position="absolute";const o=this.cache("target-offsetparent",()=>d.getOffsetParent(this.target));d.getOffsetParent(this.element)!==o&&n.defer(()=>{this.element.parentNode.removeChild(this.element),o.appendChild(this.element)}),i(e.offset,t.offset),a=!0}else s.position="absolute",i({top:!0,left:!0},t.page);if(!a)if(this.options.bodyElement)this.element.parentNode!==this.options.bodyElement&&this.options.bodyElement.appendChild(this.element);else{let t=!0,e=this.element.parentNode;for(;e&&1===e.nodeType&&"BODY"!==e.tagName&&!p(e);){if("static"!==getComputedStyle(e).position){t=!1;break}e=e.parentNode}t||(this.element.parentNode.removeChild(this.element),this.element.ownerDocument.body.appendChild(this.element))}const h={};let r=!1;for(let t in s){let e=s[t];this.element.style[t]!==e&&(r=!0,h[t]=e)}r&&n.defer(()=>{l.extend(this.element.style,h),this.trigger("repositioned")})}_addClasses(){const{classes:t,classPrefix:e}=this.options;a.addClass(this.element,a.getClass("element",t,e)),!1!==this.options.addTargetClasses&&a.addClass(this.target,a.getClass("target",t,e))}_removeClasses(){const{classes:t,classPrefix:e}=this.options;a.removeClass(this.element,a.getClass("element",t,e)),!1!==this.options.addTargetClasses&&a.removeClass(this.target,a.getClass("target",t,e)),this.all.forEach(t=>{this.element.classList.remove(t),this.target.classList.remove(t)})}}v.modules=[],c.position=b;let y=l.extend(v,c);return y.modules.push({initialize(){const{classes:t,classPrefix:e}=this.options;this.markers={},["target","element"].forEach(s=>{const i=document.createElement("div");i.className=a.getClass(`${s}-marker`,t,e);const o=document.createElement("div");o.className=a.getClass("marker-dot",t,e),i.appendChild(o),this[s].appendChild(i),this.markers[s]={dot:o,el:i}})},position({manualOffset:t,manualTargetOffset:e}){const s={element:t,target:e};for(let t in s){const e=s[t];for(let s in e){let i=e[s];(!f.isString(i)||-1===i.indexOf("%")&&-1===i.indexOf("px"))&&(i+="px"),this.markers[t].dot.style[s]!==i&&(this.markers[t].dot.style[s]=i)}}return!0}}),t.attach("intg.Tether",y)});
//# sourceMappingURL=sourcemaps/Tether.js.map
